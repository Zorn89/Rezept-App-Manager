# .github/workflows/main.yml

name: Node.js CI/CD auf AWS Elastic Beanstalk

# Trigger: Der Workflow startet bei jedem Push auf den main-Branch
on:
  push:
    branches:
      - main
  # Erm√∂glicht manuelles Starten des Workflows √ºber die GitHub UI
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: 1. Code auschecken
      uses: actions/checkout@v4

    - name: 2. Node.js Umgebung einrichten
      uses: actions/setup-node@v4
      with:
        node-version: '20' # Passen Sie dies an Ihre Node-Version an

    - name: 3. Abh√§ngigkeiten installieren
      # F√ºhrt 'npm install' aus, um alle Pakete zu laden
      run: npm install

    - name: 4. Frontend-Build (Falls n√∂tig)
      # Wenn Sie ein Frontend (React/Vue) im selben Repo h√§tten, 
      # w√ºrden Sie hier 'npm run build' ausf√ºhren.
      # Da das Frontend statisch ist, ist dieser Schritt optional/leer.
      run: echo "Kein separater Build-Schritt n√∂tig f√ºr dieses Projekt."

    - name: 5. AWS-Zugangsdaten konfigurieren
      uses: aws-actions/configure-aws-credentials@v4
      with:
        # Nutzung der GitHub Secrets
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: eu-central-1 # üö® Wichtig: Ihre AWS Region angeben!

    - name: 6. Deployment auf Elastic Beanstalk
      uses: aws/elastic-beanstalk-action@v1
      with:
        # üö® Wichtig: Passen Sie diese Namen an Ihre Konfiguration an!
        aws_region: eu-central-1
        app_name: Rezeptmanager 
        env_name: Rezeptmanager-env
        # Die Elastic Beanstalk Action verpackt den Code automatisch
        # und l√§dt ihn hoch.
        deployment_package: . # Das gesamte aktuelle Verzeichnis